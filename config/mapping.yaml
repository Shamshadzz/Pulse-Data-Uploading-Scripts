# Mapping configuration: Excel workbook sheets to CDS entities and CSV columns
# Fill in the Excel column names on the left side of each columnMap entry.
# We will not change existing CSV headers; only append rows.

version: 1
workbook: "Khavda Phase-3 Solar_Projects and SO Data (1).xlsx"
mode: append-only # never modify headers or existing rows

# ID policy:
# - generate_if_blank: if ID cell is missing/empty, generate UUIDv4
# - preserve: keep provided UUIDs as-is
# For foreign keys, you can either provide *_ID columns directly or define lookups by natural/business keys.

sheets:
  # --- Master: SPVs ---
  - sheet: "SPVs" # TODO: set actual sheet name
    entity: SPVS
    csvFile: data/CCTECH.DRS.ENTITIES-SPVS.csv
    id:
      column: ID
      uuidPolicy: generate_if_blank
    columnMap:
      "SPV Name": NAME # TODO: set Excel column
    defaults: {}

  # --- Master: Vendors ---
  - sheet: "Vendors" # TODO: set actual sheet name
    entity: VENDORS
    csvFile: data/CCTECH.DRS.ENTITIES-VENDORS.csv
    id:
      column: ID
      uuidPolicy: generate_if_blank
    columnMap:
      "Vendor Code": CODE # TODO
      "Vendor Name": NAME # TODO
      "GSTIN": GST_NUMBER # TODO
    defaults: {}

  # --- Master: Projects ---
  - sheet: "Projects" # TODO: set actual sheet name
    entity: PROJECTS
    csvFile: data/CCTECH.DRS.ENTITIES-PROJECTS.csv
    id:
      column: ID
      uuidPolicy: generate_if_blank
    columnMap:
      "Project Name": NAME # TODO
      "Type": TYPE # TODO
      "Category": CATEGORY # TODO
    lookups:
      SPV_ID:
        entity: SPVS
        match:
          - field: NAME
            from: "SPV Name" # TODO: Excel column that identifies SPV
    defaults:
      RFI_COUNT: 0
      NC_COUNT: 0

  # --- Master: Solar Project Attributes (MMS Type & Capacity) ---
  - sheet: "Khavda-PhIII-Solar-SO Mapping"
    entity: SOLARPROJECTATTRIBUTES
    csvFile: data/CCTECH.DRS.ENTITIES-SOLARPROJECTATTRIBUTES.csv
    id:
      column: ID
      uuidPolicy: generate_if_blank
    columnMap:
      "MMS Type": MMS_TYPE
      "Capacity\n(MWac)": CAPACITY
    lookups:
      PROJECT_ID:
        entity: PROJECTS
        match:
          - field: NAME
            from: "Project"
    defaults: {}

  # --- Master: Project Definitions (WBS top) ---
  - sheet: "ProjectDefinitions" # TODO: set actual sheet name
    entity: PROJECTDEFINITIONS
    csvFile: data/CCTECH.DRS.ENTITIES-PROJECTDEFINITIONS.csv
    id:
      column: ID
      uuidPolicy: generate_if_blank
    columnMap:
      "Project Definition Code": CODE # TODO
      "Description": DESCRIPTION # TODO
      "System Status": SYSTEM_STATUS # TODO
      "Business Area": BUSINESS_AREA # TODO
    lookups:
      PROJECT_ID:
        entity: PROJECTS
        match:
          - field: NAME
            from: "Project Name" # TODO
    defaults: {}

  # --- Transactions: Service Orders ---
  - sheet: "ServiceOrders" # TODO: set actual sheet name
    entity: SERVICEORDERS
    csvFile: data/CCTECH.DRS.ENTITIES-SERVICEORDERS.csv
    id:
      column: ID
      uuidPolicy: generate_if_blank
    columnMap:
      "SO Number": SO_NUMBER # TODO
      "Header Text": HEADER_TEXT # TODO
      "Date": DATE # TODO (yyyy-mm-dd or ISO 8601)
    lookups:
      PROJECT_ID:
        entity: PROJECTS
        match:
          - field: NAME
            from: "Project Name" # TODO
      PROJECT_DEFINITION_ID:
        entity: PROJECTDEFINITIONS
        match:
          - field: CODE
            from: "Project Definition Code" # TODO
      VENDOR_ID:
        entity: VENDORS
        match:
          - field: CODE
            from: "Vendor Code" # TODO
    defaults: {}

  # --- Optional: Link Service Orders to Packages ---
  - sheet: "ServiceOrderPackages" # TODO if present
    entity: SERVICEORDERPACKAGES
    csvFile: data/CCTECH.DRS.ENTITIES-SERVICEORDERPACKAGES.csv
    id:
      column: ID
      uuidPolicy: generate_if_blank
    columnMap: {}
    lookups:
      SERVICEORDER_ID:
        entity: SERVICEORDERS
        match:
          - field: SO_NUMBER
            from: "SO Number" # TODO
      PACKAGE_ID:
        entity: PACKAGES
        match:
          - field: NAME
            from: "Package Name" # TODO
    defaults: {}

  # --- Optional: Design Elements (Plot/Block/etc.) ---
  - sheet: "DesignElements" # TODO if present
    entity: DESIGNELEMENTS
    csvFile: data/CCTECH.DRS.ENTITIES-DESIGNELEMENTS.csv
    id:
      column: ID
      uuidPolicy: generate_if_blank
    columnMap:
      "Name": NAME # TODO
      "Type": TYPE # TODO (plot, block, table, inverter)
      "Parent External Key": PARENT_ID # Prefer lookups instead of raw ID
    lookups:
      PROJECT_ID:
        entity: PROJECTS
        match:
          - field: NAME
            from: "Project Name" # TODO
      PARENT_ID:
        entity: DESIGNELEMENTS
        match:
          - field: NAME
            from: "Parent Name" # TODO
    defaults: {}

  # --- Optional: Plots (if separately listed) ---
  - sheet: "Plots" # TODO if present
    entity: PLOTS
    csvFile: data/CCTECH.DRS.ENTITIES-PLOTS.csv
    id:
      column: ID
      uuidPolicy: generate_if_blank
    columnMap:
      "Plot Name": NAME # TODO
    lookups:
      LOCATION_ID:
        entity: LOCATIONS
        match:
          - field: NAME
            from: "Location Name" # TODO
      DESIGN_ELEMENT_ID:
        entity: DESIGNELEMENTS
        match:
          - field: NAME
            from: "Design Element Name" # TODO
    defaults: {}

# Ingestion order is computed automatically from schema unless overridden.
ingestion:
  order: auto # or provide a list of entities to force order
